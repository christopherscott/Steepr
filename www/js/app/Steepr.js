// Generated by CoffeeScript 1.3.1
(function() {
  var BREWING_CLASS, setAnimationDuration,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor; child.__super__ = parent.prototype; return child; };

  BREWING_CLASS = "brewing";

  setAnimationDuration = function(jqObj, seconds) {
    return ["-webkit-", "-moz-", "-ms-", ""].forEach(function(prefix) {
      return jqObj.css("" + prefix + "animation-duration", "" + seconds + "s");
    });
  };

  define(["jquery", "use!backbone", "Teas", "TeaListView", "../lib/swipe", "jquery_mobile"], function($, Backbone, Teas, TeaListView) {
    var Steepr;
    return Steepr = (function(_super) {

      __extends(Steepr, _super);

      Steepr.name = 'Steepr';

      function Steepr() {
        return Steepr.__super__.constructor.apply(this, arguments);
      }

      Steepr.prototype.el = $("body");

      Steepr.prototype.events = {
        "pageshow #steep": "steep"
      };

      Steepr.prototype.initialize = function() {
        var teaListView, teas;
        teas = new Teas();
        teaListView = new TeaListView({
          collection: teas
        });
        window.teas = teas;
        window.teaListView = teaListView;
        return teas.fetch({
          add: true,
          success: function(coll, resp) {
            if (!coll.length) {
              teas.loadDefaults();
            }
            return teaListView.activateSwipe();
          },
          error: function(coll, resp) {
            return console.log("Fetch Error: " + arguments);
          }
        });
      };

      Steepr.prototype.steep = function(e, data) {
        var count, current, last, steep_content, steeping_secs, times;
        steep_content = $("#steep .content");
        current = teas.getActive();
        times = current.get("times");
        count = current.get("count");
        last = times.length - 1;
        steeping_secs = times[(count < last ? count : last)];
        $("#steep .type").text(current.get("name"));
        current.incr_count();
        setAnimationDuration(steep_content, steeping_secs);
        steep_content.addClass(BREWING_CLASS);
        return setTimeout((function() {
          return steep_content.removeClass(BREWING_CLASS);
        }), steeping_secs * 1000);
      };

      return Steepr;

    })(Backbone.View);
  });

}).call(this);
