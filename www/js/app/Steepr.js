// Generated by CoffeeScript 1.3.1
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor; child.__super__ = parent.prototype; return child; };

  define(["jquery", "use!backbone", "Teas", "TeaListView", "Timer", "../lib/swipe", "jquery_mobile"], function($, Backbone, Teas, TeaListView, Timer) {
    var Steepr, setAnimationDuration;
    setAnimationDuration = function(jqObj, seconds) {
      var i, len, prefixes, _results;
      prefixes = ["-webkit-", "-moz-", "-ms-", ""];
      i = 0;
      len = prefixes.length;
      _results = [];
      while (i < len) {
        jqObj.css("" + prefixes[i] + "animation-duration", "" + steeping_secs + "s");
        _results.push(i++);
      }
      return _results;
    };
    return Steepr = (function(_super) {

      __extends(Steepr, _super);

      Steepr.name = 'Steepr';

      function Steepr() {
        return Steepr.__super__.constructor.apply(this, arguments);
      }

      Steepr.prototype.el = $("body");

      Steepr.prototype.events = {
        "pageshow #steep": "steep"
      };

      Steepr.prototype.initialize = function() {
        var teaListView, teas, that;
        that = this;
        teas = new Teas();
        teaListView = new TeaListView({
          collection: teas
        });
        window.teas = teas;
        window.teaListView = teaListView;
        return teas.fetch({
          add: true,
          success: function(coll, resp) {
            if (!coll.length) {
              teas.loadDefaults();
            }
            return teaListView.activateSwipe();
          },
          error: function(coll, resp) {
            return console.log(arguments);
          }
        });
      };

      Steepr.prototype.steep = function(e, data) {
        var count, current_tea, interval, steep, steeping_secs, tea_type, timer, times, times_threshold;
        steep = $("#steep .content");
        current_tea = teas.getActive();
        tea_type = current_tea.get("name");
        times_threshold = current_tea.get("times").length - 1;
        times = current_tea.get("times");
        count = current_tea.get("count");
        steeping_secs = times[(count < times_threshold ? count : times_threshold)];
        current_tea.incr_count();
        setAnimationDuration(steep, steeping_secs);
        steep.addClass("brewing");
        timer = new Timer();
        interval = timer.set("total", steeping_secs);
        console.log(interval);
        timer.start();
        $("#steep .type").text(tea_type);
        return setTimeout((function() {
          steep.removeClass("brewing");
          return clearInterval(interval);
        }), steeping_secs * 1000);
      };

      return Steepr;

    })(Backbone.View);
  });

}).call(this);
